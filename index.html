<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>bbb 投資戰情室 (PRO)</title>
    <!-- Libs -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --bg: #F9F7F2; --accent: #8B7355; --text: #2C3E50; --border: #E5E7EB; }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; height: 100vh; overflow: hidden; }
        .glass-panel { background: white; border: 1px solid var(--border); box-shadow: 0 2px 4px rgba(0,0,0,0.03); border-radius: 8px; }
        .header-title { font-weight: 800; color: #4B5563; border-bottom: 2px solid var(--border); padding-bottom: 0.5rem; margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center; letter-spacing: 0.05em; }
        
        /* 預估值樣式 (Data Guard) */
        .fact-row td { color: #111827; font-weight: 600; }
        .est-row td { color: #2563EB; font-weight: 700; font-style: italic; background-color: #EFF6FF; }
        .est-tag { font-size: 0.6rem; background: #2563EB; color: white; padding: 1px 3px; border-radius: 2px; margin-left: 4px; vertical-align: middle; }

        /* 風險燈號 */
        @keyframes pulseRed { 50% { box-shadow: 0 0 8px red; } }
        @keyframes pulseGreen { 50% { box-shadow: 0 0 8px green; } }
        .flash-buy { animation: pulseRed 1.5s infinite; border: 2px solid #DC2626 !important; }
        .flash-sell { animation: pulseGreen 1.5s infinite; border: 2px solid #16A34A !important; }
        
        .data-table th { @apply bg-gray-50 text-xs text-gray-500 uppercase font-bold p-2 text-right; }
        .data-table td { @apply p-2 text-sm border-b border-gray-100 text-right font-mono; }
        ::-webkit-scrollbar { width: 5px; } ::-webkit-scrollbar-thumb { background: #D1D5DB; border-radius: 4px; }
        
        /* Loading Overlay */
        .loading-overlay { position: fixed; inset: 0; background: rgba(255,255,255,0.98); z-index: 99; display: none; justify-content: center; align-items: center; flex-direction: column; }
    </style>
</head>
<body class="flex flex-col">

    <!-- Loading -->
    <div id="processingOverlay" class="loading-overlay">
        <div class="text-[#8B7355] text-5xl mb-4"><i class="fas fa-satellite-dish fa-spin"></i></div>
        <h2 class="text-xl font-bold">呼叫 bbb 戰情室...</h2>
        <p class="text-gray-500 mt-2">AI 正在分析 <span id="targetStock" class="font-bold text-[#8B7355]"></span></p>
        <p class="text-xs text-gray-400 mt-4 animate-pulse">預計耗時 60~90 秒</p>
    </div>

    <!-- JSON Modal -->
    <div id="jsonModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center">
        <div class="bg-white w-3/4 h-3/4 rounded-lg shadow-xl flex flex-col p-6 animate-fade-in-up">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-[#8B7355]"><i class="fas fa-file-import"></i> 匯入深度報告 (Colab/Gemini)</h3>
                <button onclick="toggleModal('jsonModal')" class="text-2xl text-gray-400 hover:text-black">&times;</button>
            </div>
            <textarea id="jsonInput" class="flex-1 border p-4 font-mono text-xs rounded bg-slate-50 focus:border-[#8B7355] outline-none" placeholder='請貼上 Gemini 生成的完整 JSON...'></textarea>
            <div class="mt-4 text-right">
                <button onclick="importJSON()" class="px-6 py-2 bg-[#8B7355] text-white rounded font-bold shadow hover:bg-[#6e5a40]">確認匯入</button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-[#ECE8DE] h-14 flex items-center px-6 border-b border-[#DCD6C9] justify-between shrink-0 shadow-sm z-20">
        <div class="font-black text-xl tracking-widest text-[#5A4A42]">bbb ANALYTICS <span class="text-xs font-normal text-gray-500 ml-1">PRO</span></div>
        <div class="flex items-center gap-3">
            <div id="statusBadge" class="text-xs text-gray-400 font-mono hidden md:block">Ready</div>
            <button onclick="toggleModal('jsonModal')" class="bg-[#8B7355] text-white px-3 py-1 rounded text-xs font-bold shadow flex items-center gap-1 hover:scale-105 transition">
                <i class="fas fa-plus"></i> 手動匯入
            </button>
            <button onclick="fetchData(true)" class="bg-white border border-[#D1C7B7] text-[#8B7355] px-3 py-1 rounded text-xs hover:bg-gray-50">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <!-- Sidebar -->
        <aside class="w-[22%] min-w-[250px] bg-[#F5F2EB] border-r border-[#E5E0D8] flex flex-col z-10">
            <div class="p-3 border-b border-[#E5E0D8]">
                <div class="relative">
                    <input type="text" id="addStockInput" placeholder="輸入代號 Enter 自動新增..." 
                           class="w-full bg-white border border-gray-300 rounded px-3 py-2 text-sm focus:outline-none focus:border-[#8B7355] shadow-inner font-mono">
                    <button onclick="triggerAddStock()" class="absolute right-2 top-2 text-[#8B7355] hover:text-black"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
            <div id="stockList" class="flex-1 overflow-y-auto p-2 space-y-1"></div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto bg-[#FDFBF7] p-8 scroll-smooth">
            <!-- Empty State -->
            <div id="emptyState" class="h-full flex flex-col items-center justify-center text-gray-300 select-none">
                <i class="fas fa-chart-network text-7xl mb-4 text-[#D1C7B7]"></i>
                <p>請從左側選擇或輸入代號新增分析</p>
            </div>

            <!-- Report Area -->
            <div id="dashboard" class="hidden max-w-[1600px] mx-auto space-y-6 pb-24">
                
                <!-- 1. Header Info -->
                <div class="flex justify-between items-end border-b-4 border-[#8B7355] pb-4">
                    <div>
                        <h1 class="text-5xl font-extrabold text-[#2C3E50] tracking-tighter" id="d_title">--</h1>
                        <p class="mt-2 text-sm text-gray-500 flex items-center gap-4">
                            <span><i class="far fa-clock"></i> 更新: <span id="d_date" class="font-mono"></span></span>
                            <span id="aiModelTag" class="text-xs bg-gray-100 px-2 py-0.5 rounded border">AI</span>
                        </p>
                    </div>
                    <div class="text-right">
                        <div id="d_price" class="text-6xl font-mono font-bold text-[#2C3E50]">--</div>
                        <div id="d_change" class="text-xl font-bold">--</div>
                    </div>
                </div>

                <!-- 2. Industry & Memo -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="col-span-2 glass-panel p-5">
                        <div class="header-title text-[#8B7355]">產業護城河與 AI 評析</div>
                        <div class="text-sm text-gray-700 leading-relaxed text-justify mb-4" id="d_moat_desc">--</div>
                        <div class="flex gap-4 text-xs">
                            <div class="bg-gray-50 px-3 py-2 rounded flex-1"><strong>位置：</strong> <span id="d_pos">--</span></div>
                            <div class="bg-gray-50 px-3 py-2 rounded flex-1"><strong>對手：</strong> <span id="d_comp">--</span></div>
                        </div>
                    </div>
                    <div class="col-span-1 glass-panel bg-[#FFFDF5] border-[#E8E0C0] p-4 flex flex-col">
                        <div class="header-title text-[#8B7355] border-[#DCD6C9] mb-2">投資備忘錄</div>
                        <textarea id="d_memo" class="flex-1 w-full bg-transparent border-none text-sm resize-none focus:ring-0 leading-relaxed" placeholder="寫下筆記..."></textarea>
                    </div>
                </div>

                <!-- 3. News -->
                <div class="glass-panel p-5">
                    <div class="header-title text-[#8B7355]">消息面與行事曆</div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="col-span-2 space-y-2 overflow-y-auto max-h-48 pr-2" id="d_news"></div>
                        <div class="col-span-1 border-l pl-4 space-y-2 text-xs font-mono" id="d_calendar"></div>
                    </div>
                </div>

                <!-- 4. Financials (Data Guard) -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- EPS -->
                    <div class="glass-panel p-5">
                        <div class="header-title text-[#8B7355]">EPS 成長與預估 <span class="text-xs font-normal text-blue-500 lowercase ml-2">(*blue=estimated)</span></div>
                        <div class="h-40 mb-2 relative"><canvas id="chart_eps"></canvas></div>
                        <div class="overflow-x-auto">
                            <table class="w-full data-table">
                                <thead><tr><th class="text-left">期間</th><th>毛利%</th><th>淨利%</th><th>EPS</th><th>累計</th></tr></thead>
                                <tbody id="t_eps"></tbody>
                            </table>
                        </div>
                    </div>
                    <!-- Revenue -->
                    <div class="glass-panel p-5">
                        <div class="header-title text-[#8B7355]">月營收動能</div>
                        <div class="h-40 mb-2 relative"><canvas id="chart_rev"></canvas></div>
                        <div class="overflow-x-auto">
                            <table class="w-full data-table">
                                <thead><tr><th class="text-left">月份</th><th>營收(億)</th><th>MoM%</th><th>YoY%</th></tr></thead>
                                <tbody id="t_rev"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 5. Valuation River -->
                <div class="glass-panel p-5">
                    <div class="header-title text-[#8B7355]">
                        PE 河流圖
                        <div class="text-xs font-normal text-gray-500 lowercase flex gap-3">
                            <span>PB:<b id="d_pb">-</b></span><span>ROE:<b id="d_roe">-</b></span><span class="bg-gray-100 px-2 rounded" id="d_pestatus">-</span>
                        </div>
                    </div>
                    <div class="h-96 w-full relative"><canvas id="chart_river"></canvas></div>
                </div>

                <!-- 6. Tech Strategy -->
                <div class="glass-panel p-5 border-l-[6px] border-[#8B7355]">
                    <div class="header-title text-[#8B7355]"><span>技術籌碼策略</span><span id="d_c" class="text-xs bg-gray-100 px-2 rounded text-gray-500">C: --</span></div>
                    <p class="text-sm text-gray-700 mb-4 leading-7 text-justify" id="d_tech_txt">--</p>
                    <div class="grid grid-cols-4 gap-3 text-center mb-4 text-sm">
                        <div class="p-2 border rounded"><div class="text-xs text-gray-400">30D</div><div id="p_30" class="font-bold text-blue-600">--</div></div>
                        <div class="p-2 border rounded"><div class="text-xs text-gray-400">180D</div><div id="p_180" class="font-bold text-blue-600">--</div></div>
                        <div class="p-2 border rounded"><div class="text-xs text-gray-400">360D</div><div id="p_360" class="font-bold text-blue-600">--</div></div>
                        <div class="p-2 border rounded bg-[#FFFBF0] border-[#8B7355]"><div class="text-xs text-[#8B7355] font-bold">Buy Zone</div><div id="p_entry" class="font-black text-[#C0392B]">--</div></div>
                    </div>
                    <div class="text-xs text-gray-500 bg-gray-100 p-2 rounded">BBands: <span id="d_boll" class="font-bold text-gray-700">--</span></div>
                </div>

                <!-- 7. Dividend -->
                <div class="glass-panel p-4 flex justify-between text-sm font-bold text-gray-700">
                    <span class="text-[#8B7355]"><i class="fas fa-coins mr-2"></i> 股利</span>
                    <span>Yield: <span id="d_yield">--</span></span>
                    <span>Est ROI: <span id="d_roi" class="text-[#C0392B] text-lg">--</span></span>
                </div>

            </div>
        </main>
    </div>

    <!-- JS Logic -->
    <script>
        // ------------------------------------------
        // ⚠️ 請修改 Token
        const GITHUB_TOKEN = "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"; 
        // ------------------------------------------
        
        const GITHUB_USER = "Mocha-lin"; 
        const GITHUB_REPO = "-3";
        let db = [];
        let cur = null;
        let chartObj = {river:null, eps:null, rev:null};

        window.onload = () => {
            const saved = localStorage.getItem('bbb_db_v3');
            if(saved) db = JSON.parse(saved);
            renderSidebar();
            fetchData(true); // 自動更新最新
        };

        function toggleModal(id) { document.getElementById(id).classList.toggle('hidden'); }

        async function triggerAddStock() {
            const input = document.getElementById('addStockInput');
            const id = input.value.trim().toUpperCase();
            if(!id) return;
            if(db.find(x=>x.id===id)){ alert("已存在"); loadStock(id); input.value=''; return;}
            if(GITHUB_TOKEN.includes("你的")) { alert("請先填入 Token"); return; }
            if(!confirm(`觸發 AI 自動分析 ${id} ?`)) return;

            document.getElementById('processingOverlay').style.display = 'flex';
            document.getElementById('targetStock').innerText = id;
            input.value = '';

            try {
                await fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/dispatches`, {
                    method: 'POST',
                    headers: {'Accept':'application/vnd.github.v3+json', 'Authorization': `Bearer ${GITHUB_TOKEN}`},
                    body: JSON.stringify({ event_type: 'add_stock_trigger', client_payload: { stock_id: id } })
                });
                startPolling(id);
            } catch(e) { alert("發送失敗: " + e); document.getElementById('processingOverlay').style.display='none'; }
        }

        let pollTimer;
        function startPolling(tid) {
            let n = 0; if(pollTimer) clearInterval(pollTimer);
            pollTimer = setInterval(async()=>{
                n++;
                try {
                    const res = await fetch(`./data.json?t=${Date.now()}`);
                    const d = await res.json();
                    if(d.find(s=>s.id===tid)) {
                        clearInterval(pollTimer);
                        await fetchData(true);
                        loadStock(tid);
                        document.getElementById('processingOverlay').style.display='none';
                    }
                } catch(e){}
                if(n>30) { clearInterval(pollTimer); document.getElementById('processingOverlay').style.display='none'; alert("逾時，請手動刷新"); }
            }, 5000);
        }

        async function fetchData(force=false) {
            const badge = document.getElementById('statusBadge');
            try {
                badge.innerText = "Downloading...";
                const res = await fetch(force ? `./data.json?t=${Date.now()}` : './data.json');
                const cloudData = await res.json();
                
                if(Array.isArray(cloudData) && cloudData.length>0) {
                    // Merge
                    const localData = JSON.parse(localStorage.getItem('bbb_db_v3') || '[]');
                    db = cloudData.map(c => {
                        const l = localData.find(x => x.id === c.id);
                        if(l && l.memo) c.memo = l.memo;
                        return c;
                    });
                    localStorage.setItem('bbb_db_v3', JSON.stringify(db));
                    renderSidebar();
                    if(currentStock && db.find(x=>x.id===currentStock.id)) loadStock(currentStock.id);
                    badge.innerText = `Synced ${new Date().toLocaleTimeString()}`;
                    badge.className = "text-xs font-mono text-green-600";
                }
            } catch(e) { badge.innerText="Offline"; }
        }

        function importJSON() {
            try {
                const d = JSON.parse(document.getElementById('jsonInput').value);
                const i = db.findIndex(s=>s.id===d.id);
                if(i>=0) { if(!d.memo) d.memo = db[i].memo; db[i] = d; }
                else db.unshift(d);
                
                localStorage.setItem('bbb_db_v3', JSON.stringify(db));
                toggleModal('jsonModal');
                renderSidebar();
                loadStock(d.id);
            } catch(e) { alert("JSON Error"); }
        }

        function renderSidebar() {
            const list = document.getElementById('stockList');
            const q = document.getElementById('addStockInput').value.toLowerCase(); 
            // 這裡可以優化成真的搜尋欄，為了精簡暫用同一個 input
            
            list.innerHTML = "";
            let cats = {};
            db.forEach(s => {
                const c = s.category || "未分類";
                if(!cats[c]) cats[c] = [];
                cats[c].push(s);
            });

            for(let [c, items] of Object.entries(cats)) {
                const grp = document.createElement('div');
                grp.innerHTML = `<div class="text-[10px] font-bold text-gray-400 uppercase tracking-widest px-2 py-1 bg-gray-50 border-b cursor-pointer flex justify-between" onclick="this.nextElementSibling.classList.toggle('hidden')">${c} <i class="fas fa-angle-down"></i></div>`;
                const ul = document.createElement('div');
                ul.className = "space-y-1 p-1";
                
                items.forEach(s => {
                    const el = document.createElement('div');
                    const sig = s.technical?.signal_light || "";
                    let cls = "border-transparent";
                    if(sig.includes('red')) cls="flash-buy"; else if(sig.includes('green')) cls="flash-sell";
                    
                    if(cur && cur.id===s.id) cls += " bg-white shadow border-l-4 border-l-[#8B7355]";
                    
                    el.className = `p-2 rounded cursor-pointer border hover:bg-white flex justify-between items-center transition ${cls}`;
                    el.innerHTML = `<div><div class="font-bold text-[#2C3E50] font-mono">${s.id}</div><div class="text-xs text-gray-500 w-20 truncate">${s.name}</div></div><div class="text-xs font-bold ${parseFloat(s.basicInfo.change)>0?'text-red-500':'text-green-600'}">${s.basicInfo.changePercent}</div>`;
                    el.onclick = () => loadStock(s.id);
                    ul.appendChild(el);
                });
                
                new Sortable(ul, { animation:150 });
                grp.appendChild(ul);
                list.appendChild(grp);
            }
        }

        function loadStock(id) {
            const s = db.find(x => x.id === id);
            if(!s) return;
            cur = s;
            document.getElementById('emptyState').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            renderSidebar();

            document.getElementById('d_title').innerHTML = `<span class="text-[#8B7355] mr-3">${s.id}</span>${s.name}`;
            document.getElementById('d_date').innerText = s.lastUpdated;
            document.getElementById('aiModelTag').innerText = s.ai_model || "AI";
            
            const chg = parseFloat(s.basicInfo.changePercent.replace('%',''));
            const col = chg>=0 ? "text-[#C0392B]" : "text-[#16A34A]";
            document.getElementById('d_price').innerText = s.basicInfo.price;
            document.getElementById('d_price').className = `text-6xl font-mono font-bold tracking-tighter ${col}`;
            document.getElementById('d_change').innerText = `${s.basicInfo.change} (${s.basicInfo.changePercent})`;
            document.getElementById('d_change').className = `text-xl font-bold ${col}`;

            document.getElementById('d_moat_desc').innerText = s.industry.moat_status + " | " + (s.industry.position_map || "");
            document.getElementById('d_pos').innerText = s.industry.position_map;
            document.getElementById('d_comp').innerText = s.industry.competitors;
            const memo = document.getElementById('d_memo');
            memo.value = s.memo || "";
            memo.oninput = () => { s.memo = memo.value; localStorage.setItem('bbb_db_v3', JSON.stringify(db)); };

            // Financials
            renderTable('t_eps', s.financials.eps_table||[], ['period','gross_margin','net_margin','eps','cumulative']);
            renderTable('t_rev', (s.financials.revenue_trend||[]).slice(0,12), ['month','revenue','mom','yoy']);
            
            // Valuation
            setText('d_pb', s.financials.valuation.pb);
            setText('d_roe', s.financials.valuation.roe);
            setText('d_pestatus', s.financials.valuation.pe_status);

            // Technical
            setText('d_c', "C: "+s.technical.correction_c);
            document.getElementById('d_tech_txt').innerText = s.technical.analysis_text;
            setText('p_30', s.technical.predictions.days30);
            setText('p_180', s.technical.predictions.days180);
            setText('p_360', s.technical.predictions.days360);
            setText('p_entry', s.technical.predictions.entry_zone);
            setText('d_boll', s.technical.bollinger.status);

            // Div
            setText('d_yield', s.dividend.yield);
            setText('d_roi', s.dividend.future_roi);

            // News
            const nb = document.getElementById('d_news'); nb.innerHTML='';
            (s.news_events.news||[]).forEach(n=>{
               const isNew = n.is_new ? '<span class="bg-red-500 text-white px-1 text-[9px] rounded mr-1">NEW</span>' : '';
               const c = n.type.includes('pos')?'text-red-600':(n.type.includes('neg')?'text-green-600':'text-gray-600');
               nb.innerHTML += `<div class="text-sm border-b pb-1 mb-1 flex"><span class="w-20 font-mono text-gray-400 text-xs shrink-0">${n.date}</span><span class="${c}">${isNew}${n.title}</span></div>`;
            });
            const cb = document.getElementById('d_calendar'); cb.innerHTML='';
            (s.news_events.calendar||[]).forEach(c=> cb.innerHTML+=`<div>${c.date} <b class="text-[#8B7355]">${c.event}</b></div>`);

            renderCharts(s);
        }

        function renderTable(domId, data, keys) {
            const el = document.getElementById(domId); el.innerHTML = '';
            data.forEach(r => {
                const cls = r.is_estimate ? "est-row" : "fact-row";
                const tag = r.is_estimate ? '<span class="est-tag">預</span>' : '';
                let h = `<tr class="${cls}">`;
                keys.forEach((k,i) => {
                    const align = i===0 ? 'text-left' : 'text-right';
                    h += `<td class="${align}">${r[k]}${i===0?tag:''}</td>`;
                });
                el.innerHTML += h + '</tr>';
            });
        }

        function renderCharts(s) {
            const ctxPe = document.getElementById('chart_river').getContext('2d');
            if(chartObj.river) chartObj.river.destroy();
            const river = s.financials.valuation.pe_river_data;
            if(river && river.price) {
                chartObj.river = new Chart(ctxPe, {
                    type: 'line',
                    data: {
                        labels: river.dates,
                        datasets: [
                            { label: '現價', data: river.price, borderColor:'#374151', borderWidth:3, pointRadius:0, tension:0.1, z:10 },
                            { label: 'H', data: river.pe20, borderColor:'#DC2626', borderDash:[5,5], pointRadius:0, fill:false },
                            { label: 'L', data: river.pe12, borderColor:'#16A34A', borderDash:[5,5], pointRadius:0, fill:false }
                        ]
                    },
                    options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, elements:{point:{radius:0}} }
                });
            }

            const ctxEps = document.getElementById('chart_eps').getContext('2d');
            if(chartObj.eps) chartObj.eps.destroy();
            const eT = s.financials.eps_table || [];
            chartObj.eps = new Chart(ctxEps, {
                type: 'line',
                data: {
                    labels: eT.map(x=>x.period),
                    datasets: [{
                        label: 'EPS', data: eT.map(x=>parseFloat(x.eps)),
                        borderColor: '#2563EB', backgroundColor: '#93C5FD', fill: true,
                        segment: { borderDash: ctx => ctx.p0DataIndex >= eT.findIndex(x=>x.is_estimate) ? [5,5] : undefined }
                    }]
                },
                options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{x:{grid:{display:false}}} }
            });

            const ctxRev = document.getElementById('chart_rev').getContext('2d');
            if(chartObj.rev) chartObj.rev.destroy();
            const rT = (s.financials.revenue_trend || []).slice(0,12).reverse();
            chartObj.rev = new Chart(ctxRev, {
                type: 'bar',
                data: {
                    labels: rT.map(x=>x.month),
                    datasets: [{ label:'營收', data: rT.map(x=>parseFloat(x.revenue)), backgroundColor: rT.map(x=>x.is_estimate?'#93C5FD':'#D1D5DB') }]
                },
                options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{x:{display:false},y:{display:false}} }
            });
        }

        function setText(id,t){const e=document.getElementById(id);if(e)e.innerText=t||'-';}
    </script>
</body>
</html>